<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–∫–∞–Ω–µ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞</title>

  <!-- ‚úÖ –°—é–¥–∞ –≤—Å—Ç–∞–≤–ª—è–µ–º CSS -->
  <style>
    body {
  font-family: 'Segoe UI', sans-serif;
  background-color: #f9f9f9;
  margin: 0;
  padding: 20px;
  text-align: center;
}

h1 {
  font-size: 1.6em;
  margin-bottom: 20px;
  color: #333;
}

#reader {
  margin: auto;
  max-width: 320px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

select {
  margin-top: 15px;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
}

.result {
  margin-top: 25px;
  padding: 12px 20px;
  background-color: #fff;
  display: inline-block;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  font-size: 16px;
}

.result p {
  margin: 8px 0;
  font-weight: 500;
}

.result .name {
  color: #28a745;
  font-weight: bold;
  font-size: 18px;
}
  </style>

  <!-- üì¶ –°—é–¥–∞ –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å html5-qrcode -->
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

  <!-- ‚úÖ –°—é–¥–∞ –≤—Å—Ç–∞–≤–ª—è–µ–º HTML-–∫–æ–Ω—Ç–µ–Ω—Ç -->
  <h1>üì∑ –°–∫–∞–Ω–µ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞</h1>

<div id="reader"></div>

<select id="cameraSelect"></select>

<div class="result" id="scanResult">
  <p class="name">‚úî –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω</p>
  <p>üìÖ –î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è: <strong>01/09/2024</strong></p>
</div>

  <!-- ‚úÖ –í–Ω–∏–∑—É ‚Äî JavaScript –¥–ª—è –ª–æ–≥–∏–∫–∏ -->
  <script>
    const resultBox = document.getElementById('result');
    const fullNameSpan = document.getElementById('fullName');
    const joinDateSpan = document.getElementById('joinDate');

    function onScanSuccess(decodedText) {
      const url = `https://qr-id-system.onrender.com/lookup?id=${decodedText}`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          fullNameSpan.textContent = data.name;
          joinDateSpan.textContent = data.join_date;
          resultBox.style.display = 'block';
        })
        .catch(err => {
          fullNameSpan.textContent = '‚ùå –£—á–∞—Å—Ç–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω';
          joinDateSpan.textContent = '';
          resultBox.style.display = 'block';
        });
    }

    const html5QrCode = new Html5Qrcode("reader");

    Html5Qrcode.getCameras().then(devices => {
      const cameraSelect = document.getElementById("cameraSelect");
      devices.forEach((device, index) => {
        const option = document.createElement("option");
        option.value = device.id;
        option.text = device.label || `–ö–∞–º–µ—Ä–∞ ${index + 1}`;
        cameraSelect.appendChild(option);
      });

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é
      html5QrCode.start(devices[0].id, {
        fps: 10,
        qrbox: 250
      }, onScanSuccess);

      cameraSelect.addEventListener('change', () => {
        html5QrCode.stop().then(() => {
          html5QrCode.start(cameraSelect.value, {
            fps: 10,
            qrbox: 250
          }, onScanSuccess);
        });
      });
    });
  </script>

</body>
</html>
